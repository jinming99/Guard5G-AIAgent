# Fake Base Station Configuration
# Location: OAI-5G/tools/fbs_scenarios/fake_gnb.cfg
# This configuration creates a rogue gNB for testing FBS detection

Active_gNBs = ( "gNB-FBS");
# Asn1_verbosity, choice in: none, info, annoying
Asn1_verbosity = "none";

gNBs =
(
 {
    ////////// Identification parameters:
    gNB_ID    = 0xe01;  # Different from legitimate gNB
    gNB_name  = "gNB-FBS";

    # Tracking Area Code - Different from legitimate network
    tracking_area_code  = 999;  # Suspicious TAC

    # Mobile Country Code/Mobile Network Code
    # Using same as legitimate network to perform PLMN spoofing
    plmn_list = (
      {
        mcc = 001;  # Spoofed MCC
        mnc = 01;   # Spoofed MNC
        mnc_length = 2;
        snssaiList = (
          {
            sst = 1;
            sd  = 0x000000;
          }
        );
      }
    );

    # Physical parameters
    nr_cellid = 12345678901;  # Different cell ID
    physCellId = 999;  # Suspicious PCI (max is 1007)
    
    # Frequency configuration
    dl_carrierBandwidth = 106;  # 20 MHz
    ul_carrierBandwidth = 106;  # 20 MHz
    
    # Using different frequency to avoid interference with legitimate gNB
    # But close enough to cause UE confusion
    dl_absoluteFrequencyPointA = 640000;  # Different from main gNB
    ul_absoluteFrequencyPointA = 640000;
    dl_frequencyShift7p5khz = "disable";
    ul_frequencyShift7p5khz = "disable";
    
    # Frame configuration
    frame_type = "TDD";
    tdd_config = {
      referenceSubcarrierSpacing = 30;
      dl_ul_periodicity = 5;
      nrofDownlinkSlots = 7;
      nrofDownlinkSymbols = 6;
      nrofUplinkSlots = 2;
      nrofUplinkSymbols = 4;
    };
    
    ssPbchBlockPower = 10;  # High power to attract UEs
    
    # Security settings - Weakened
    servingCellConfigCommon = (
      {
        # ... other parameters ...
      }
    );

    # AMF/Security Configuration - No real core connection
    amf_ip_address = (
      {
        ipv4       = "127.0.0.1";  # Localhost - no real AMF
        ipv6       = "::1";
        active     = "yes";
        preference = "ipv4";
      }
    );

    # Network interfaces
    NETWORK_INTERFACES = {
      GNB_INTERFACE_NAME_FOR_NG_AMF = "lo";  # Loopback - isolated
      GNB_IPV4_ADDRESS_FOR_NG_AMF   = "127.0.0.1";
      
      GNB_INTERFACE_NAME_FOR_NGU = "lo";
      GNB_IPV4_ADDRESS_FOR_NGU   = "127.0.0.1";
      GNB_PORT_FOR_NGU            = 2153;
    };
  }
);

# Security Configuration - Weakened for FBS simulation
security = {
    # Disable/weaken security features
    integrity_algorithm = "nia0";  # No integrity protection
    ciphering_algorithm = "nea0";  # No ciphering (NULL algorithm)
    
    # Fake keys (not real)
    key = "00000000000000000000000000000000";
};

# MAC Layer Configuration
MACRLCs = (
  {
    num_cc           = 1;
    tr_s_preference  = "local_L1";
    tr_n_preference  = "local_RRC";
    pusch_TargetSNRx10 = 150;
    pucch_TargetSNRx10 = 200;
    
    # Scheduler configuration
    scheduler_mode = "default";
    
    # HARQ configuration
    dl_harq_processes = 8;
    ul_harq_processes = 8;
  }
);

# RF Simulator Configuration (ZMQ)
L1s = (
  {
    num_cc = 1;
    tr_n_preference = "local_mac";
    prach_dtx_threshold = 120;
    pucch0_dtx_threshold = 150;
    ofdm_offset_divisor = 8;
  }
);

RUs = (
  {
    local_rf       = "yes";
    nb_tx          = 1;
    nb_rx          = 1;
    att_tx         = 0;
    att_rx         = 0;
    bands          = [78];
    max_pdschReferenceSignalPower = -27;
    max_rxgain     = 114;
    eNB_instances  = [0];
    
    # High TX power to overpower legitimate signal
    tx_gain        = 90;  # Maximum gain
    rx_gain        = 125;
    
    # ZMQ configuration for RF simulator
    # Using different ports to avoid conflict
    sdr_addrs      = "tcp://127.0.0.1:4201,tcp://127.0.0.1:4202";
    clock_src      = "internal";
  }
);

# Thread configuration
THREAD_STRUCT = (
  {
    # Isolated CPU cores for FBS
    L1_rx_thread_core = 2;
    L1_tx_thread_core = 3;
    ru_thread_core = 4;
  }
);

# Log Configuration
log_config = {
    global_log_level                      = "info";
    hw_log_level                          = "info";
    phy_log_level                         = "info";
    mac_log_level                         = "info";
    rlc_log_level                         = "info";
    pdcp_log_level                        = "info";
    rrc_log_level                         = "info";
    ngap_log_level                        = "info";
    f1ap_log_level                        = "info";
};

# FBS-specific parameters
fbs_config = {
    # FBS behavior configuration
    mode = "active";  # active or passive
    
    # Attack parameters
    reject_probability = 0.8;  # Reject 80% of attach requests
    force_null_cipher = true;  # Force null ciphering
    random_redirect = true;  # Send random redirects
    
    # Timing parameters
    activation_delay = 5;  # Seconds before starting attacks
    attack_duration = 300;  # Attack for 5 minutes
    
    # Signal manipulation
    power_boost = 10;  # dB above normal
    frequency_offset = 100;  # Hz offset
};